<script setup>
const loader = ref(null);

const { gsap } = useGsap();
const emitter = useEmitter();

emitter.on('shader:running', () => {
  gsap.to(loader.value, {
    autoAlpha: 0,
    pointerEvents: 'none',
    onComplete: () => emitter.emit('loader:end'),
  });
});
</script>

<template>
  <div ref="loader" class="loader">
    <svg
      class="loader__svg"
      width="512"
      height="512"
      viewBox="0 0 512 512"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g clip-path="url(#clip0_415_685)">
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M516 -6H-4V518H516V-6ZM149.142 317.069C138.399 317.069 128.527 314.46 119.523 309.243C110.52 303.923 103.359 296.659 98.0388 287.451C92.8211 278.141 90.2123 267.706 90.2123 256.145C90.2123 244.993 92.9234 234.814 98.3457 225.606C103.87 216.398 111.185 209.135 120.291 203.815C129.498 198.495 139.269 195.835 149.602 195.835C156.763 195.835 162.442 196.5 166.636 197.83C170.831 199.057 175.69 201.257 181.215 204.428V210.106C175.997 206.526 171.138 204.019 166.636 202.587C162.237 201.052 156.712 200.285 150.062 200.285C139.934 200.285 130.675 202.894 122.286 208.111C113.999 213.227 107.4 220.133 102.489 228.829C97.6807 237.423 95.2765 246.682 95.2765 256.605C95.2765 266.632 97.7319 275.942 102.643 284.535C107.553 293.129 114.05 299.984 122.132 305.099C130.317 310.112 139.115 312.619 148.528 312.619C155.28 312.619 161.163 311.852 166.176 310.317C171.189 308.68 176.202 306.173 181.215 302.797V308.475C176.304 311.442 171.24 313.591 166.022 314.921C160.907 316.353 155.28 317.069 149.142 317.069ZM226.045 198.904H267.326V203.354H231.109V265.967H261.341V270.417H231.109V309.55H267.326V314H226.045V198.904ZM331.477 308.629C340.684 314.256 350.659 317.069 361.402 317.069C372.246 317.069 382.221 314.358 391.327 308.936C400.534 303.411 407.798 295.994 413.118 286.684C418.54 277.272 421.252 267.041 421.252 255.992C421.252 245.249 418.54 235.274 413.118 226.066C407.798 216.757 400.586 209.39 391.48 203.968C382.375 198.546 372.4 195.835 361.555 195.835C350.813 195.835 340.838 198.597 331.63 204.121C322.422 209.544 315.107 216.91 309.685 226.22C304.263 235.428 301.552 245.352 301.552 255.992C301.552 266.734 304.212 276.811 309.532 286.223C314.954 295.533 322.269 303.002 331.477 308.629ZM388.718 305.099C380.329 310.112 371.223 312.619 361.402 312.619C351.58 312.619 342.475 310.112 334.086 305.099C325.696 299.984 318.995 293.129 313.982 284.535C309.071 275.839 306.616 266.427 306.616 256.298C306.616 246.272 309.071 236.962 313.982 228.368C318.995 219.775 325.696 212.971 334.086 207.958C342.475 202.843 351.631 200.285 361.555 200.285C371.377 200.285 380.482 202.843 388.871 207.958C397.261 212.971 403.911 219.775 408.821 228.368C413.732 236.962 416.187 246.272 416.187 256.298C416.187 266.427 413.681 275.839 408.668 284.535C403.757 293.129 397.107 299.984 388.718 305.099Z"
          fill="var(--surface-color)"
        />
      </g>
      <defs>
        <clipPath id="clip0_415_685">
          <rect
            width="512"
            height="512"
            fill="white"
            transform="translate(0.536133 0.453735)"
          />
        </clipPath>
      </defs>
    </svg>
  </div>
</template>

<style lang="scss">
.loader {
  display: flex;
  justify-content: center;
  align-items: center;

  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 10;

  pointer-events: all;

  &::after {
    --circle-size: 52%;

    content: '';

    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: -1;

    background: radial-gradient(
      circle at center,
      transparent var(--circle-size),
      var(--surface-color) calc(var(--circle-size) + 0.25%)
    );
    background-size: 100% 100%;
    background-position: 50% 50%;
  }

  &__svg {
    height: 100%;
    width: 100%;

    max-width: 100%;
    max-height: 100%;
  }

  &__text {
    position: absolute;
    top: 50%;
    left: 50%;

    margin: 0;

    transform: translate(-50%, -50%);

    &--primary {
      font-size: var(--step-5);

      color: transparent;
      -webkit-text-stroke: 1px white;
    }
  }
}
</style>

